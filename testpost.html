
<html lang="en">

	
	<head>
		<meta charset="utf-8">
		<title>Petals</title>
		<script type="text/javascript" src="d3.v3/d3.v3.min.js"></script>
		<script type="text/javascript" src="jquery-history/scripts/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="jquery-history/scripts/jquery.history.min.js"></script>
		<style type="text/css">
			body 						{background-color: #252525;}
			
			
			.captioncontainer			{width:400px; margin-left:auto; margin-right:auto;}
			.caption					{background-color: #dddddd;;border-style: solid;border:none;padding: 1ex;}
			#button						{width:4ex; height:3ex; background-color:#aaaaaa; padding: 3px;}
			#message					{background-color:white;}
			
			
			
			
		</style>
	</head>
	<body>
		
		<div class="captioncontainer">
			
			
			<INPUT TYPE="text" NAME="caption1" class="caption" id="caption" SIZE="40">
			<div><div id="button"></div><div id="message"></div>
			</div>
			
		</div>
		
		
	<script>
		var LOG_LVLS = {"debug":0,"info":1,"warning":2,"error":3};
		var LOG_LVL = "debug";
		
		
		
		var filename = "kees.txt";
		var content = "er was eens een keer2";
		var writetofilescript = "write_to_file.php";

		d3.select("#button")
			.text("save")
			.on("click",function(){
			    writetofile(filename,$("#caption").val());
			});  
			
		//get current content of file
		 d3.text(filename, function(unparsedData)
		  {
		   var data = d3.csv.parseRows(unparsedData);
		   
		   $("#caption").val(data);
		  }).on("error",function(){
		  		log("Caption file '"+filename+"' not found. Not displaying caption","debug");
		  						})
		  ;
    
		
				
		function writetofile(filename,content){
			    var dataString = 'file='+ filename + '&content=' + content;  

				$.ajax({  
				  type: "post",  
				  url: "write_to_file.php",  
				  data: {"file":filename,"content":content},  
				  success: function(data, status, xhr) {  
					$('#message').html("* "+data);
				  },
				  error: function(xhr,status,errorText) {
					$('#message').html("Error: "+errorText +" "+ status+ " "+ xhr);


				  }
				});	
		
		}
		function log(msg,lvl){
					if(lvl == null){lvl = "info";}
					if(LOG_LVLS[lvl] >= LOG_LVLS[LOG_LVL]){			
						console.log("* "+lvl+" - "+msg);
					}
		}

		
    
	</script>
		
	</body>
</html>